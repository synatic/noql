{
  "bugfix": {
    "join-fn": {
      "case1": {
        "expectedResults": [
          {
            "customerId": 1,
            "quantity": 2,
            "Category": "Fats",
            "priceZAR": 264
          },
          {
            "customerId": 1,
            "quantity": 2,
            "Category": "Real Order",
            "priceZAR": 264
          }
        ]
      }
    }
  },
  "new": {
    "iif": {
      "case1": {
        "expectedResults": [
          {
            "item": "almonds",
            "digits": "double digits"
          }
        ]
      }
    },
    "dateAdd": {
      "case1": {
        "expectedResults": [
          {
            "id": 2,
            "item": "pecans",
            "od1": "$date-placeholder",
            "od2": "$date-placeholder"
          }
        ]
      },
      "case2": {
        "expectedResults": [
          {
            "id": 2,
            "item": "pecans",
            "od1": "$date-placeholder",
            "od2": "$date-placeholder"
          }
        ]
      }
    },
    "dateSubtract": {
      "case1": {
        "expectedResults": [
          {
            "id": 2,
            "item": "pecans",
            "od1": "$date-placeholder",
            "od2": "$date-placeholder"
          }
        ]
      },
      "case2": {
        "expectedResults": [
          {
            "id": 2,
            "item": "pecans",
            "od1": "$date-placeholder",
            "od2": "$date-placeholder"
          }
        ]
      }
    },
    "dateDiff": {
      "case1": {
        "expectedResults": [
          {
            "id": 2,
            "item": "pecans",
            "orderDate": "$date-placeholder",
            "now": "$date-placeholder",
            "diff": 2
          }
        ]
      }
    },
    "left": {
      "case1": {
        "expectedResults": [
          {
            "id": 2,
            "firstTwoChars": "pe"
          }
        ]
      }
    }
  },
  "pivot": {
    "case1": {
      "expectedResults": [
        {
          "0": 5.0885,
          "1": 223.88,
          "2": 359.1082,
          "3": null,
          "4": 949.4105,
          "CostSortedByProductionDays": "AverageCost"
        }
      ]
    },
    "case2": {
      "expectedResults": [
        {
          "0": {
            "StandardCost": 5.0885,
            "MaxCost": 5.0885
          },
          "1": {
            "StandardCost": 223.88,
            "MaxCost": 223.88
          },
          "2": {
            "StandardCost": 359.1082,
            "MaxCost": 359.1082
          },
          "3": null,
          "4": {
            "StandardCost": 949.4105,
            "MaxCost": 949.4105
          },
          "CostSortedByProductionDays": "Costs"
        }
      ]
    }
  },
  "unpivot": {
    "case1": {
      "expectedResults": [
        {
          "VendorID": 1,
          "Employee": "Emp1",
          "Orders": 4
        },
        {
          "VendorID": 1,
          "Employee": "Emp2",
          "Orders": 3
        },
        {
          "VendorID": 1,
          "Employee": "Emp3",
          "Orders": 5
        },
        {
          "VendorID": 1,
          "Employee": "Emp4",
          "Orders": 4
        },
        {
          "VendorID": 1,
          "Employee": "Emp5",
          "Orders": 4
        },
        {
          "VendorID": 2,
          "Employee": "Emp1",
          "Orders": 4
        },
        {
          "VendorID": 2,
          "Employee": "Emp2",
          "Orders": 1
        },
        {
          "VendorID": 2,
          "Employee": "Emp3",
          "Orders": 5
        },
        {
          "VendorID": 2,
          "Employee": "Emp4",
          "Orders": 5
        },
        {
          "VendorID": 2,
          "Employee": "Emp5",
          "Orders": 5
        },
        {
          "VendorID": 3,
          "Employee": "Emp1",
          "Orders": 4
        },
        {
          "VendorID": 3,
          "Employee": "Emp2",
          "Orders": 3
        },
        {
          "VendorID": 3,
          "Employee": "Emp3",
          "Orders": 5
        },
        {
          "VendorID": 3,
          "Employee": "Emp4",
          "Orders": 4
        },
        {
          "VendorID": 3,
          "Employee": "Emp5",
          "Orders": 4
        },
        {
          "VendorID": 4,
          "Employee": "Emp1",
          "Orders": 4
        },
        {
          "VendorID": 4,
          "Employee": "Emp2",
          "Orders": 2
        },
        {
          "VendorID": 4,
          "Employee": "Emp3",
          "Orders": 5
        },
        {
          "VendorID": 4,
          "Employee": "Emp4",
          "Orders": 5
        },
        {
          "VendorID": 4,
          "Employee": "Emp5",
          "Orders": 4
        },
        {
          "VendorID": 5,
          "Employee": "Emp1",
          "Orders": 5
        },
        {
          "VendorID": 5,
          "Employee": "Emp2",
          "Orders": 1
        },
        {
          "VendorID": 5,
          "Employee": "Emp3",
          "Orders": 5
        },
        {
          "VendorID": 5,
          "Employee": "Emp4",
          "Orders": 5
        },
        {
          "VendorID": 5,
          "Employee": "Emp5",
          "Orders": 5
        }
      ]
    },
    "case2": {
      "expectedResults": [
        {
          "SalesID": 1001,
          "OrderNum": 1,
          "OrderName": "first",
          "OrderDate": "2018-01-01"
        },
        {
          "SalesID": 1001,
          "OrderNum": 2,
          "OrderName": "second",
          "OrderDate": "2018-02-01"
        }
      ],
      "pipeline": [
        {
          "$unset": [
            "_id"
          ]
        },
        {
          "$project": {
            "SalesID": "$SalesID",
            "Order1Name": "$Order1Name",
            "Order2Name": "$Order2Name",
            "Order1Date": "$Order1Date",
            "Order2Date": "$Order2Date",
            "Order1Amt": "$Order1Amt",
            "Order2Amt": "$Order2Amt"
          }
        },
        {
          "$project": {
            "SalesID": "$SalesID",
            "fields": {
              "$objectToArray": "$$ROOT"
            }
          }
        },
        {
          "$project": {
            "SalesID": 1,
            "fields": {
              "$filter": {
                "input": "$fields",
                "as": "field",
                "cond": {
                  "$and": [
                    {
                      "$ne": [
                        "$$field.k",
                        "SalesID"
                      ]
                    },
                    {
                      "$or": [
                        {
                          "$eq": [
                            "$$field.k",
                            "Order1Name"
                          ]
                        },
                        {
                          "$eq": [
                            "$$field.k",
                            "Order2Name"
                          ]
                        },
                        {
                          "$eq": [
                            "$$field.k",
                            "Order1Date"
                          ]
                        },
                        {
                          "$eq": [
                            "$$field.k",
                            "Order2Date"
                          ]
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        {
          "$unwind": "$fields"
        },
        {
          "$project": {
            "SalesID": 1,
            "OrderName": {
              "$cond": {
                "if": {
                  "$or": [
                    {
                      "$eq": [
                        "$fields.k",
                        "Order1Name"
                      ]
                    },
                    {
                      "$eq": [
                        "$fields.k",
                        "Order2Name"
                      ]
                    }
                  ]
                },
                "then": "$fields.v",
                "else": "$$REMOVE"
              }
            },
            "OrderDate": {
              "$cond": {
                "if": {
                  "$or": [
                    {
                      "$eq": [
                        "$fields.k",
                        "Order1Date"
                      ]
                    },
                    {
                      "$eq": [
                        "$fields.k",
                        "Order2Date"
                      ]
                    }
                  ]
                },
                "then": "$fields.v",
                "else": "$$REMOVE"
              }
            }
          }
        },
        {
          "$group": {
            "_id": {
              "SalesID": "$SalesID"
            },
            "OrderNames": {
              "$push": "$OrderName"
            },
            "OrderDates": {
              "$push": "$OrderDate"
            }
          }
        },
        {
          "$unwind": {
            "path": "$OrderNames",
            "includeArrayIndex": "__unwindIndex",
            "preserveNullAndEmptyArrays": false
          }
        },
        {
          "$project": {
            "_id": 0,
            "SalesID": "$_id.SalesID",
            "OrderName": "$OrderNames",
            "OrderDate": {
              "$arrayElemAt": [
                "$OrderDates",
                "$__unwindIndex"
              ]
            }
          }
        },
        {
          "$project": {
            "unpvt": "$$ROOT"
          }
        },
        {
          "$setWindowFields": {
            "sortBy": {
              "OrderName": 1
            },
            "output": {
              "OrderNum": {
                "$documentNumber": {}
              }
            }
          }
        },
        {
          "$project": {
            "SalesID": "$unpvt.SalesID",
            "OrderNum": "$OrderNum",
            "OrderName": "$unpvt.OrderName",
            "OrderDate": "$unpvt.OrderDate"
          }
        }
      ]
    }
  }
}